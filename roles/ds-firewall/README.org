#+TITLE: DeadSwitch Firewall Role
#+AUTHOR: DeadSwitch | The Silent Architect
#+OPTIONS: toc:nil num:nil \n:t

* Overview
Minimal firewall management using UFW with sane defaults.
Applies CIS Level 1/2 server hardening /guidance/:
- Deny all incoming by default.
- Allow all outgoing by default.
- Permit only required services (SSH).

* Defaults
#+begin_src yaml
firewall_default_incoming: deny
firewall_default_outgoing: allow
firewall_allowed_ports:
  - port: "{{ sshd_port | default('22') }}"
    proto: tcp
#+end_src

* Tasks
1. Install and enable UFW.
2. Set default incoming/outgoing policies.
3. Allow configured ports from =firewall_allowed_ports=.
4. Enable and start the UFW service.

* Variables

| Variable                    | Type   | Default | Comment                              |
|-----------------------------+--------+---------+--------------------------------------|
| =firewall_default_incoming= | string | =deny=  | Default incoming rule.               |
| =firewall_default_outgoing= | string | =allow= | Default outgoing rule.               |
| =firewall_allowed_ports=    | list   | -       | List of ports and protocols to allow |

* Example

Include it in your playbook:

#+begin_src yaml
- hosts: servers
  roles:
    - role: ds-firewall
      vars:
        firewall_allowed_ports:
          - { port: "{{ sshd_port | default('22') }}", proto: tcp }
          - { port: "53", proto: udp }
          - { port: "443", proto: tcp }
#+end_src

* License
MIT.

=[Fear the Silence. Fear the Switch.]=
